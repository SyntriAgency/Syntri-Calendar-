<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Syntri — Prosty szkielet kalendarza (HTML)</title>
  <style>
    :root {
      --bg: #f6f6f6;
      --card: #ffffff;
      --ink: #111111;
      --muted: #6b7280;
      --border: #e5e7eb;
      --ring: #111111;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; color: var(--ink); background: var(--bg); }

    .app { display: grid; grid-template-columns: 1fr; gap: 16px; padding: 16px; max-width: 1200px; margin: 0 auto; }
    @media (min-width: 1024px) { .app { grid-template-columns: 2fr 1fr; } }

    .card { background: var(--card); border: 1px solid var(--border); border-radius: 16px; box-shadow: 0 1px 2px rgba(0,0,0,.04); }
    .toolbar { display:flex; align-items:center; justify-content:space-between; gap:8px; padding:12px 12px; border-bottom:1px solid var(--border); }
    .title { font-size: 18px; font-weight: 600; text-transform: capitalize; }
    .btn { appearance: none; border: 1px solid var(--border); background: white; padding: 6px 10px; border-radius: 10px; cursor: pointer; }
    .btn:hover { background: #f8fafc; }

    .weekdays { display:grid; grid-template-columns: repeat(7, 1fr); gap: 4px; padding: 8px 12px 0; color: var(--muted); font-size: 12px; text-transform: uppercase; letter-spacing:.03em; }
    .weekdays div { padding: 8px; }

    .grid { display:grid; grid-template-columns: repeat(7, 1fr); grid-auto-rows: 100px; gap: 4px; padding: 8px 12px 12px; }
    .day { position: relative; display:flex; flex-direction:column; gap:6px; padding: 10px; background: white; border:1px solid var(--border); border-radius: 12px; text-align:left; cursor:pointer; transition: background .15s ease; }
    .day.out { opacity:.55; }
    .day:hover { background:#f8fafc; }
    .day .n { font-size: 13px; font-weight: 600; }
    .day .badge { font-size: 10px; padding: 2px 6px; border:1px solid var(--border); border-radius: 999px; }
    .day.selected { outline: 2px solid var(--ring); outline-offset: 0; }

    .panel { position: sticky; top: 16px; min-height: 260px; }
    .panel .head { padding: 12px; border-bottom:1px solid var(--border); }
    .panel .sub { color: var(--muted); font-size: 13px; }
    .panel .date { font-size: 16px; font-weight: 600; }

    .slots { display:flex; flex-direction:column; }
    .slot { display:flex; align-items:center; justify-content:space-between; padding: 10px 12px; border-bottom:1px solid var(--border); background: transparent; cursor: pointer; text-align:left; }
    .slot:hover { background:#f8fafc; }
    .slot.active { background: #111111; color: white; }
    .slot .mark { font-size: 11px; opacity:.75; }

    .visually-hidden { position:absolute; width:1px; height:1px; margin:-1px; padding:0; border:0; clip:rect(0 0 0 0); overflow:hidden; white-space:nowrap; }
  </style>
</head>
<body>
  <main class="app">
    <!-- Kalendarz -->
    <section class="card" aria-label="Kalendarz miesięczny">
      <div class="toolbar">
        <div class="title" id="monthLabel">—</div>
        <div class="actions" role="group" aria-label="Nawigacja miesiąca">
          <button class="btn" id="prevBtn" aria-label="Poprzedni miesiąc">←</button>
          <button class="btn" id="todayBtn">Dziś</button>
          <button class="btn" id="nextBtn" aria-label="Następny miesiąc">→</button>
        </div>
      </div>
      <div class="weekdays" aria-hidden="true">
        <div>Pn</div><div>Wt</div><div>Śr</div><div>Cz</div><div>Pt</div><div>So</div><div>Nd</div>
      </div>
      <div class="grid" id="grid" role="grid" aria-labelledby="monthLabel"></div>
    </section>

    <!-- Panel boczny ze slotami -->
    <aside class="card panel" aria-label="Panel slotów godzinowych">
      <div class="head">
        <div class="sub">Wybrany dzień</div>
        <div class="date" id="selectedDateLabel">Kliknij dzień w kalendarzu</div>
      </div>
      <div class="slots" id="slots" role="listbox" aria-label="Sloty czasowe"></div>
    </aside>
  </main>

  <script>
    // ===== Konfiguracja slotów =====
    const SLOT_START_HOUR = 8;   // 08:00
    const SLOT_END_HOUR = 18;    // 18:00 (exclusive)
    const SLOT_STEP_MIN = 60;    // co 60 min

    // ===== Stan =====
    const now = new Date();
    let cursor = new Date(now.getFullYear(), now.getMonth(), 1); // pierwszy dzień bieżącego miesiąca
    let selectedDate = null; // Date | null
    const selectedSlots = new Set(); // klucze: YYYY-MM-DDTHH:mm

    // ===== Elementy =====
    const monthLabelEl = document.getElementById('monthLabel');
    const gridEl = document.getElementById('grid');
    const selectedDateLabelEl = document.getElementById('selectedDateLabel');
    const slotsEl = document.getElementById('slots');
    document.getElementById('prevBtn').addEventListener('click', () => { cursor = addMonths(cursor, -1); render(); });
    document.getElementById('nextBtn').addEventListener('click', () => { cursor = addMonths(cursor, 1); render(); });
    document.getElementById('todayBtn').addEventListener('click', () => { cursor = new Date(now.getFullYear(), now.getMonth(), 1); render(); });

    // ===== Render =====
    function render() {
      // label miesiąca
      monthLabelEl.textContent = cursor.toLocaleDateString(undefined, { month: 'long', year: 'numeric' });
      // siatka 6x7
      const days = buildMonthMatrix(cursor);
      gridEl.innerHTML = '';
      days.forEach(d => {
        const inMonth = d.getMonth() === cursor.getMonth();
        const isTodayFlag = sameDate(d, new Date());
        const isSelected = selectedDate && sameDate(selectedDate, d);

        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'day' + (inMonth ? '' : ' out') + (isSelected ? ' selected' : '');
        btn.setAttribute('role', 'gridcell');
        btn.setAttribute('aria-pressed', isSelected ? 'true' : 'false');
        btn.addEventListener('click', () => {
          selectedDate = new Date(d.getFullYear(), d.getMonth(), d.getDate());
          renderSelectedDay();
          render(); // re-render siatkę, by podświetlić
        });

        const top = document.createElement('div');
        top.style.display = 'flex';
        top.style.alignItems = 'center';
        top.style.justifyContent = 'space-between';

        const dn = document.createElement('div');
        dn.className = 'n';
        dn.textContent = String(d.getDate());
        top.appendChild(dn);

        if (isTodayFlag) {
          const badge = document.createElement('span');
          badge.className = 'badge';
          badge.textContent = 'Dziś';
          top.appendChild(badge);
        }

        const filler = document.createElement('div');
        filler.style.marginTop = 'auto';
        filler.style.fontSize = '11px';
        filler.style.color = 'var(--muted)';
        filler.textContent = '—';

        btn.appendChild(top);
        btn.appendChild(filler);
        gridEl.appendChild(btn);
      });

      // panel (jeśli wcześniej wybrany)
      renderSelectedDay();
    }

    function renderSelectedDay() {
      if (!selectedDate) {
        selectedDateLabelEl.textContent = 'Kliknij dzień w kalendarzu';
        slotsEl.innerHTML = '';
        return;
      }
      selectedDateLabelEl.textContent = formatHumanDate(selectedDate);
      // zbuduj sloty
      const slots = buildSlots(selectedDate, SLOT_START_HOUR, SLOT_END_HOUR, SLOT_STEP_MIN);
      slotsEl.innerHTML = '';
      slots.forEach(({hour, minute, label}) => {
        const key = slotKey(selectedDate, hour, minute);
        const active = selectedSlots.has(key);
        const li = document.createElement('button');
        li.type = 'button';
        li.className = 'slot' + (active ? ' active' : '');
        li.setAttribute('role', 'option');
        li.setAttribute('aria-pressed', active ? 'true' : 'false');
        li.addEventListener('click', () => {
          if (selectedSlots.has(key)) selectedSlots.delete(key); else selectedSlots.add(key);
          console.log('slot:', key, selectedSlots.has(key) ? 'selected' : 'unselected');
          renderSelectedDay();
        });

        const left = document.createElement('span');
        left.textContent = label;
        const right = document.createElement('span');
        right.className = 'mark';
        right.textContent = active ? 'Wybrano' : '';

        li.appendChild(left); li.appendChild(right);
        slotsEl.appendChild(li);
      });
    }

    // ===== Utils =====
    function buildMonthMatrix(cursor) {
      const y = cursor.getFullYear();
      const m = cursor.getMonth();
      const first = new Date(y, m, 1);
      const firstWeekdayMon0 = (first.getDay() + 6) % 7; // 0..6, 0=Pn
      const start = new Date(y, m, 1 - firstWeekdayMon0);
      const cells = [];
      for (let i = 0; i < 42; i++) {
        const d = new Date(start);
        d.setDate(start.getDate() + i);
        cells.push(d);
      }
      return cells;
    }
    function sameDate(a, b) {
      return a.getFullYear() === b.getFullYear() && a.getMonth() === b.getMonth() && a.getDate() === b.getDate();
    }
    function addMonths(date, delta) {
      return new Date(date.getFullYear(), date.getMonth() + delta, 1);
    }
    function formatHumanDate(d) {
      return d.toLocaleDateString(undefined, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
    }
    function slotKey(date, hour, minute) {
      const yyyy = date.getFullYear();
      const mm = String(date.getMonth() + 1).padStart(2, '0');
      const dd = String(date.getDate()).padStart(2, '0');
      const hh = String(hour).padStart(2, '0');
      const mi = String(minute).padStart(2, '0');
      return `${yyyy}-${mm}-${dd}T${hh}:${mi}`;
    }
    function buildSlots(date, startHour, endHour, stepMin) {
      const out = [];
      for (let h = startHour; h < endHour; h++) {
        for (let m = 0; m < 60; m += stepMin) {
          out.push({hour: h, minute: m, label: `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`});
        }
      }
      return out;
    }

    // start
    render();
  </script>
</body>
</html>
